# qtMeCabon

何処にでもあるライトノベル（テキストファイル）読み上げソフト

# DEMO

![MeCabon実行中画面](https://github.com/miyabin1701/qtmecabon/blob/images/qtMecabon-xxxx.png)

# Features

長文(17Mでテストしました）でも読み上げられるようにしました。
形態素解析ライブラリMeCabを使っていますので、辞書を育てていけば誤読を減らしていけると考えています。利用者の皆様の何々ノベル用辞書（コーパス）を各々公開して頂ければ、より誤読の少ない辞書を作っていけると信じています。お願いします。

# Requirement

qtMeCabon 動作に必要なライブラリ

* libmecab.dll(x64) 同梱 形態素解析ライブラリ
* MeCab その他のexeファイル 辞書の更新に使用します。Binary package for MS-Windows
      [https://taku910.github.io/mecab/]
* portaudio_x64.dll 同梱 ポートオーディオライブラリ
* voicevox_core.dll 同梱 ヴォイスボックスコアライブラリ
* onnxruntime.dll 同梱 ヴォイスボックスが使用するライブラリ
* Qt6Core.dll他のQt用ライブラリ

# Installation

* 上記 MeCab のURLより、Binary package for MS-Windowsをダウンロードし　bin フォルダーの中身を mecab-0.996/bin フォルダーにコピーしてください。このパッケージ内のdllやexeファイルは32Bitビルドです。 qtMecabon.exe と同じフォルダーに libmecab64.dll 64Bitビルド版を同梱しています。
  
  
# Usage

qtMeCabonを起動するとメインダイヤログが表示されます。
最初にご利用の際は、設定ダイヤログの Mecab タブ他の項目について設定を行ってください。
設定ダイヤログの表示はエディットコントロール内で右クリックした際のポップアップ
メニューから行ってください。

![設定ダイヤログ](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-xxxx.png)

1. Mecab.exeのパス
辞書更新時はこのパスからmecab-dict-index.exe等他のツールを起動します。

2. システム辞書フォルダー
下記辞書ホルダー構成の n:\\.......\final の部分を設定してください。

3. システム辞書構築フォルダー
辞書構築フォルダーは下記構成となります。
n:\\.......\work の部分を設定してください。
    n:\\......\work\seed
                    \final

　\work\seed, \work\final 各フォルダーには現状各２個zipファイルが入っています。それぞれ、そのフォルダーに解凍してください。各ファイルサイズが50MByteを超えていて、githubの１ファイルのサイズ制限値を超えるため個別に圧縮してサイズを減らしています。解凍後はzipファイルを消していただいて構いません。
　

4. 文字セットは現在UTF-8固定になっています。
text editorは、utf-8文字セットが使える物なら、普段使いのエディターを設定してください。
utf-8が使えない場合はnotepad++が良いかもしれません。
5. editor optionは、エディター起動オプションでタグジャンプ時の行番号とファイルパスの
与え方を指定してください。csv辞書ファイル検索後、該当位置にタグジャンプするための設定です。

    notepad++の場合は -n%l %f です。%l は行番号に、%f はファイル名に置き換えられます。

6. 一番下に TTS セレクト用リストボックスがありますので、とりあえず、VOICEVOXでお試しください。たぶん、一択だと思います。
このセレクタの設定されているTTSのオプションタブを開くことができます。
TTS設定タブは、とりあえず、いじらなくても発声することが可能です。

OKボタンで設定ダイヤログを閉じてください。

後は、メインダイヤログのエディットコントロールにテキストをコピペするか、テキストファイルをドラッグドロップするかして、PLAYボタンを押すだけです。PLAY状態になるとPLAYボタンはPOUSEボタンに替わります。
発声時、Mecabの未登録語（以後未知語）やAquesTalkのWAVE生成エラーはインフォメーションダイヤログに表示されます。発声の停止はSTOPボタンでお願いします。

ファイルのドラッグドロップ時は、一応文字コード判別（UTF-8,UTF16-LE等）を行い変換を行って
いますが、何でも変換できるわけではございませんので、予めユニコードに変換されることをお勧めします。

初見の文章は Mecab の未知語が多数出てくると思われます。この際、発声はスキップして未知語を
すべて洗い出して、未知語を辞書に登録する方がいいと思います。発声スキップオプションもポップアップメニューにつけています。ご利用ください。例えばカタカナの名前で在っても、登録することで前後の漢字の解析精度が上がるようです。

発声時に、読み間違いも出てきます。聞いていて違うと感じた際は、PAUSE して読み間違いの文章を選択して、ポップアップメニューの corpas を使ってください。インフォメーションダイヤログにコーパス形式の表示を行います。読み間違いの語彙を選択し、ポップアップメニューで検索を行ってください。インフォメーションダイヤログにcsv辞書ファイル検索結果を表示します。正解の読み品詞があればテキストエディタにコーパスダイヤログの一連のコーパス行をコピペして頂き、読み間違い行を検索結果の読み正解行に置き換えてください。もし、csv辞書検索結果に読みの正解が表示されなかった場合は、追加用の辞書に登録していってください。また、送り仮名の過不足で検索ができないことも在ります。検索文字列に追記して検索することで検索できることもありました。

コーパスとcsv検索他ダイヤログ
![1. ](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-corpas2.png)
![2. ](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-corpas3.png)
![3. ](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-corpas5.png)
![4. ](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-corpas6.png)

ある程度、新規追加語、コーパスがたまったら、辞書をビルドしてください。辞書更新の際は、STOPボタンで発声を停止してください。発声中は libmecab.dll とが辞書を開いているためロックがかかってファイルの更新ができないのです。そのうえ、見た目は正常に更新終了したと振舞うため更新したのに出来ていなかったことがあり得ます。

辞書のビルドエラーについて、追加した語彙又は、コーパスファイルのフォーマットエラー、ファイル末尾の改行だけの行であることがほとんどです。追加した部分を再確認してください。追加用の辞書は、一般的な語彙の辞書とその本専用辞書（登場人物の名前や特有の言い回し）を分けて行うと良いでしょう。work\seed フォルダー内であれば拡張子が.csvのファイルを追加してもmecabは辞書をビルドしてくれます。
注：現在辞書ビルドはステップ４／４でエラーになります。voicevox-core ver0.16 で解消されると言っていただいています。それまでは、このエラーが出た後、work/finalフォルダー内にバッチファイル 　"dicblds4.bat” を出力するようにしましたので、qtmecabonを終了後にバッチファイルを実行してください。

メインダイヤログのポップアップメニューでその他に

![メインダイヤログのポップアップメニュー](https://github.com/miyabin1701/qtmecabon/blob/images/qtmecabon-corpas7.png)

1. モニター休止連動PAUSE PCで設定時間後にモニターの電源を休止する設定を行っていた際に自動で PAUSE します。モニターのスピーカーから音を出している場合にお使いください。私の寝落ち対策；；また、モニター休止時にも再生可能なUSBスピーカーなどから鳴らす場合はチェックを外してください。メッセージが来ないときがあるようで PAUSE にならない時が在るようです。気休め程度とお考え下さい。
2. 記号読みパス 通常！マークなどいくつかの記号（発音記号でない記号）を"びっくり"等と発声します。
それをパスする際の設定です。辞書で登録している記号の読みは除きます。
3. 発声スキップ 先ほど述べた、初見の文章の未知語を洗い出すためのオプションです。
4. この行から再生カーソルのある行から再生します。
5. この上の行まで削除 先頭からカーソルのある行の上の行まで削除します。
6. 前回ドラッグ＆ドロップしたファイルパス 続きを読めるようにしました。前回 qtMeCabon を終了した時に持っていた行番号付近にスクロールしますので、上記この行から再生メニューで再生してください。

メインダイヤログの下部のボタンなど

1. 検索ボタン 横のエディットボックス内の文字列を検索します。前回何話まで読んだ等の場合、（何＋１）話等の文字列を検索してください。
何メガもの文章を読み込めるので、検索機能が無いと探すのが辛かったので追加しました。
2. Volumeダイヤル ポートオーディオのボリューム設定です。ほぼ即時音量を変えられます。
設定ダイヤログの各TTSの設定内にもボリューム設定がありますが、そちらは、生成波形の大きさをコントロールします。当然、波形生成済みで再生キューに入っている分は音量を変化することはできません。
3. 各エディットボックス内の文字サイズ CTRL＋ジョグダイヤルで変更可能です。

メインダイヤログのエディットコントロールは読んでいる際、読んでいる行辺りを反転表示します。しかし、何行か＊２段階でキューに入れるので、その辺り程度とご理解ください。

メインダイヤログのエディットコントロールにどの程度の容量のテキストファイルを読み込めるのか？ですが、今のところ17M程度は大丈夫のようでした。何らか(PCのメモリー容量等)の制限があるかもしれませんが．．．

小説家になろうサイトの下記二つのタイトルで動作確認を行いました。

1. 17Mの本好きの下克上（PDFをテキスト化した後１行が長すぎないよう改行を追加した、１ページの文章が１行としてPDF内に入っています。１行がUTF8で１０００文字未満になるよう適度に改行を
入れてください。）
2. 6.5Mの転生したらスライムだった件（テキストファイルをDL後全話を１ファイルにまとめたもの）

# Note

* このソフトの改良を一緒に行って頂ける方募集中です。

# Author

* miyabin

# License

"portaudio"         Copyright (c) 1999-2011 Ross Bencina and Phil Burk
                    https://www.portaudio.com/license.html

"miniz.c v1.15"     Rich Geldreich 詳細はminiz.cファイルを参照してください。
                    http://unlicense.org/

"libmecab64.dll"
"mecab-0.996"       Copyright © 2001-2006 Taku Kudo
                    Copyright © 2004-2006 Nippon Telegraph and Telephone Corporation

"voicevox_core.lib" Copyright (c) 2021 Hiroshiba Kazuyuki
"onnxruntime.dll"   Copyright (c) Microsoft Corporation
voicevox音声ライブラリクレジット
「VOICEVOX:四国めたん」
「VOICEVOX:ずんだもん」
「VOICEVOX:春日部つむぎ」
「VOICEVOX:波音リツ」
「VOICEVOX:玄野武宏」
「VOICEVOX:白上虎太郎」
「VOICEVOX:青山龍星」
「VOICEVOX:冥鳴ひまり」
「VOICEVOX:九州そら」
「VOICEVOX:もち子(cv 明日葉よもぎ)」
「VOICEVOX:剣崎雌雄」
「VOICEVOX:WhiteCUL」
「VOICEVOX:後鬼」
「VOICEVOX:No.7」
「VOICEVOX:ちび式じい」
「VOICEVOX:櫻歌ミコ」
「VOICEVOX:小夜/SAYO」
「VOICEVOX:ナースロボ＿タイプＴ」
「VOICEVOX:†聖騎士 紅桜†」
「VOICEVOX:雀松朱司」
「VOICEVOX:麒ヶ島宗麟」
「VOICEVOX:春歌ナナ」
「VOICEVOX:猫使アル」
「VOICEVOX:猫使ビィ」
「VOICEVOX:中国うさぎ」
「VOICEVOX:栗田まろん」
「VOICEVOX:あいえるたん」
「VOICEVOX:満別花丸」
「VOICEVOX:琴詠ニア」
VOICEVOXの許諾内容、音声モデルの利用規約は model フォルダーの readme.txt を参照の上遵守してください。

"qtMeCabon" は [MIT lisence]といたします。
Copyright (c) 2024 miyabin
Released under the MIT license  https://opensource.org/license/mit/

サポートブログ      https://qtmecabon.techblog.jp/archives/4254570.html

